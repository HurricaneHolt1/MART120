<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Escape Game</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
  </head>
  <body>
    <script>
      let playerX = 50;
      let playerY = 50;
      let playerSpeed = 4;

      let obstacles = [];
      let staticObstacle = null;

      let exitX = 350;
      let exitY = 350;
      let exitSize = 40;

      function setup() {
        createCanvas(400, 400);

        // Moving obstacles
        obstacles.push(makeObstacle(100, 200));
        obstacles.push(makeObstacle(250, 100));
        obstacles.push(makeObstacle(150, 300));
      }

      function draw() {
        background(220);

        movePlayer();
        moveObstacles();

        drawExit();
        drawPlayer();
        drawObstacles();
        drawStaticObstacle();

        checkWin();
      }

      // ------------------------
      // PLAYER MOVEMENT (FIXED)
      // ------------------------
      function movePlayer() {
        // Only move if a key is being pressed â€” no more drifting downward.
        if (keyIsDown(LEFT_ARROW)) {
          playerX -= playerSpeed;
        }
        if (keyIsDown(RIGHT_ARROW)) {
          playerX += playerSpeed;
        }
        if (keyIsDown(UP_ARROW)) {
          playerY -= playerSpeed;
        }
        if (keyIsDown(DOWN_ARROW)) {
          playerY += playerSpeed;
        }

        // Keep player inside canvas
        playerX = constrain(playerX, 0, width);
        playerY = constrain(playerY, 0, height);
      }

      function drawPlayer() {
        fill(0, 0, 255);
        rect(playerX, playerY, 20, 20);
      }

      // ------------------------
      // OBSTACLES
      // ------------------------
      function makeObstacle(x, y) {
        return {
          x: x,
          y: y,
          w: random(20, 40),
          h: random(20, 40),
          xspeed: random(-2, 2),
          yspeed: random(-2, 2),
          r: random(255),
          g: random(255),
          b: random(255)
        };
      }

      function moveObstacles() {
        for (let obs of obstacles) {
          obs.x += obs.xspeed;
          obs.y += obs.yspeed;

          // Wrap around screen
          if (obs.x > width) obs.x = 0;
          if (obs.x < 0) obs.x = width;
          if (obs.y > height) obs.y = 0;
          if (obs.y < 0) obs.y = height;
        }
      }

      function drawObstacles() {
        for (let obs of obstacles) {
          fill(obs.r, obs.g, obs.b);
          rect(obs.x, obs.y, obs.w, obs.h);
        }
      }

      // ------------------------
      // STATIC OBSTACLE (mouse)
      // ------------------------
      function mousePressed() {
        if (staticObstacle === null) {
          staticObstacle = {
            x: mouseX,
            y: mouseY,
            size: 30
          };
        }
      }

      function drawStaticObstacle() {
        if (staticObstacle !== null) {
          fill(100, 20, 150);
          rect(staticObstacle.x, staticObstacle.y, staticObstacle.size, staticObstacle.size);
        }
      }

      // ------------------------
      // EXIT
      // ------------------------
      function drawExit() {
        fill(0, 255, 0);
        rect(exitX, exitY, exitSize, exitSize);
      }

      function checkWin() {
        if (
          playerX > exitX &&
          playerX < exitX + exitSize &&
          playerY > exitY &&
          playerY < exitY + exitSize
        ) {
          fill(0);
          textSize(30);
          textAlign(CENTER);
          text("YOU WIN!", width / 2, height / 2);
          noLoop();
        }
      }
    </script>
  </body>
</html>
